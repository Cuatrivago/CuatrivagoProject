@model CuatrivagoProjectAdmin.Models.ModelsForRoomImage
@{
    ViewBag.Title = "RoomImage";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section content{

    @if (Request.Cookies["upIm"] != null)
    {
        if (Request.Cookies["upIm"]["tr"] == "-1")
        {
            <div>
                <font color="blue">Seleccione un archivo por favor.</font>
            </div>
        }
        else if (Request.Cookies["upIm"]["tr"] == "0")
        {
            <div>
                <font color="green">Imagen actualizada con éxito.</font>
            </div>
        }
        else if (Request.Cookies["upIm"]["tr"] == "1")
        {
            <div>
                <font color="red">Extensión no admitida, solo se permiten ".jpg", ".png" y ".jpeg".</font>
            </div>
        }
        else if (Request.Cookies["upIm"]["tr"] == "2")
        {
            <div>
                <font color="red">Tamaño invalido, debe ser menor a 2mb.</font>
            </div>
        }
        else if (Request.Cookies["upIm"]["tr"] == "3")
        {
            <div>
                <font color="red">No se pudo guardar la imagen, se canceló la actualización.</font>
            </div>
        }
        else if (Request.Cookies["upIm"]["tr"] == "4")
        {
            <div>
                <font color="blue">No se pudo eliminar la imagen vieja, no obstante la actualizacion se efectuó.</font>
            </div>
        }
        else if (Request.Cookies["upIm"]["tr"] == "5")
        {
            <div>
                <font color="red">Hubo problema en base de datos, no se pudo actualizar.</font>
            </div>
        }
        HttpCookie galleta = new HttpCookie("upIm");
        galleta.Expires = DateTime.Now.AddDays(-1);
        Response.Cookies.Add(galleta);
    }

    <select onchange="selecRoom(this.value)">
        @foreach( var room in Model.roomList)
        {
            <option value="@room.idRoom">@room.description_</option>
        }

    </select>

    <img src="../../CuatrivagoProject/Content/imagesRoom/junnior.jpg" />
 
    <div id="formUpload">
        <label>Imagenes actuales</label>
        <div id="imgOld">

        </div>
        @using (Html.BeginForm("UploadImage", "RoomImage", FormMethod.Post,
                        new { enctype = "multipart/form-data" }))
        {
            <label>Imagen nueva</label>
            <input type="file" name="file" id="file" />
            <input type="submit" class="btn btn-default submit" id="btnAccept" name="btnAccept" value="Cambiar" onclick="upload()" />
        }
    </div>

    <script src="~/Content/vendors/jquery/dist/jquery.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#formUpload').hide();
        });

        function selecRoom(ogt) {
            $('#formUpload').hide('slow');

            $.ajax({
                type: "POST",
                url: '@Url.Action("getImage", "RoomImage")',
                contentType: "application/json; charset=utf-8",
                data: "{'id':'" + ogt + "'}",
                dataType: "json",
                success: function (data) {
                    $('#imgOld').html(data);
                    $('#formUpload').show('slow');
                },
                error: function (xhr, status, error) {
                    alert("Error" + xhr.responseText + " " + status + " " + error);
                }
            });
        }

        /*function upload() {
            var data = new FormData();
            var files = $('#file').get(0).files;

            if(files.length > 0){
                data.append("img", files[0]);
            }
            
            $.ajax({
                url: "http://localhost:57673/Image/Upload",
                type: "POST",
                processData: false,
                contentType: false,
                data: data,
                success: function () {
                    //code after success
                    alert("Ya");
                },
                error: function (xhr, status, error) {
                    alert("Error" + xhr.responseText + " " + status + " " + error);
                }

            });

        }*/

    </script>
}